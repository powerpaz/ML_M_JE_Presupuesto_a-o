<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Rubros C2 — Mapa y Tabla (Versión Ligera)</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" crossorigin="anonymous"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" crossorigin="anonymous"/>
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>
  <script defer src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js" crossorigin="anonymous"></script>

  <!-- ======== ESTILOS ======== -->
  <style>
    :root{
      --prim:#21335c;        /* Azul institucional */
      --prim-dk:#1a274a;
      --muted:#6b7a99;
      --bg:#f7f9fc;
      --card:#ffffff;
      --dash:#d9e1f0;
    }

    *{box-sizing:border-box;}
    html,body{height:100%;margin:0;}
    body{
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,"Noto Sans",sans-serif;
      color:#111;
      background:var(--bg);
    }

    /* ------- HEADER ------- */
    header{
      display:flex;
      align-items:center;
      gap:16px;
      padding:12px 20px;
      background:var(--prim);
      color:#fff;
      border-bottom:3px solid var(--prim-dk);
    }
    header img{
      height:60px;
      max-width:160px;
      object-fit:contain;
    }
    header h1{
      margin:0;
      line-height:1.25;
      font-weight:800;
      color:#fff;
      font-size:20px;
    }
    header h1 span{
      display:block;
      font-weight:500;
      font-size:16px;
      opacity:.95;
    }
    @media(max-width:640px){
      header{flex-direction:column;text-align:center;}
      header img{height:52px;}
      header h1{font-size:18px;}
    }

    /* ------- LAYOUT ------- */
    .layout{display:flex;min-height:calc(100vh - 100px);}
    aside{
      width:420px;
      max-width:460px;
      flex:0 0 auto;
      background:var(--card);
      border-right:1px solid #e6ecf2;
    }
    main{
      flex:1 1 auto;
      min-width:0;
      position:relative;
      background:#eef3fb;
    }
    #map{width:100%;height:calc(100vh - 100px);}
    @media(max-width:900px){
      .layout{flex-direction:column;}
      aside{
        width:100%;max-width:none;border-right:none;border-bottom:1px solid #e6ecf2;
      }
      main{height:70vh;}
      #map{height:70vh;}
    }

    /* ------- PANELS ------- */
    .panel{border-bottom:1px solid #eef2f7;}
    .panel-header{
      padding:10px 14px;
      background:#fff;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .panel-title{font-weight:700;color:var(--prim);}
    .muted{color:var(--muted);font-size:12px;}
    .pad{padding:10px 14px;}

    /* ------- TABLE ------- */
    table{width:100%;border-collapse:collapse;}
    th,td{padding:8px;border-bottom:1px dashed var(--prim);}
    th{color:var(--prim);text-align:left;background:#f2f5fb;}
    td:last-child,th:last-child{text-align:right;}
    tfoot td{font-weight:800;border-bottom:none;}

    /* ------- BUTTONS ------- */
    button{
      padding:6px 10px;
      border-radius:10px;
      border:1px solid #d6dde7;
      background:#fff;
      cursor:pointer;
      transition:background .15s ease,transform .05s ease;
    }
    button:hover{background:#f6f9ff;}
    button:active{transform:translateY(1px);}

    /* ------- FILTERS ------- */
    .filters{display:grid;grid-template-columns:1fr;gap:8px;}
    .filters label{font-size:12px;color:#334;display:block;margin-bottom:2px;}
    .filters input,.filters select{
      width:100%;
      padding:8px;
      border:1px solid #d6dde7;
      border-radius:8px;
      background:#fbfdff;
    }
    .filters .row{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
    @media(max-width:420px){.filters .row{grid-template-columns:1fr;}}

    /* ------- MAP LEGEND ------- */
    .legend{
      position:absolute;
      right:12px;
      bottom:14px;
      background:#fff;
      border:1px solid #d6dde7;
      border-radius:10px;
      padding:8px 10px;
      font-size:12px;
      box-shadow:0 2px 10px rgba(0,0,0,.08);
    }

    .status{margin-left:8px;}
    tbody tr td:first-child{border-right:1px dotted var(--dash);}
  </style>

  <!-- Script principal -->
  <script defer src="app.js"></script>
</head>
<body>

  <!-- HEADER -->
  <header>
    <img src="logo.png" alt="Logo institucional">
    <h1>Ministerio de Educación — Rubros C2
      <span>Tabla + Mapa (Versión Ligera)</span>
    </h1>
  </header>

  <!-- LAYOUT -->
  <div class="layout">
    <aside>
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">Filtros</div>
          <div><span class="muted status" id="status">Cargando…</span></div>
        </div>
        <div class="pad">
          <div class="filters">
            <div>
              <label for="amieTxt">AMIE</label>
              <input id="amieTxt" type="text" placeholder="Buscar por AMIE (exacto o parcial)">
            </div>
            <div class="row">
              <div>
                <label for="provSel">PROVINCIA</label>
                <select id="provSel"><option value="">Todas</option></select>
              </div>
              <div>
                <label for="cantSel">CANTÓN</label>
                <select id="cantSel"><option value="">Todos</option></select>
              </div>
            </div>
            <div>
              <button id="btnLimpiar">Limpiar filtros</button>
            </div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">Tabla principal</div>
          <div><button id="btnExport">Exportar CSV</button></div>
        </div>
        <div class="pad">
          <table id="rubrosTable">
            <thead><tr><th>Rubro</th><th>Costo</th></tr></thead>
            <tbody></tbody>
            <tfoot><tr><td>Total</td><td id="totalCell">—</td></tr></tfoot>
          </table>
          <div class="muted" id="countInstituciones" style="margin-top:6px">Instituciones: —</div>
          <div class="muted" id="filtrosActivos" style="margin-top:4px">Filtros activos: —</div>
        </div>
      </div>
    </aside>

    <main>
      <div id="map"></div>
      <div class="legend">
        <div><b>Mapa — Rubros C2</b></div>
        <div class="muted">Provincias simplificadas para carga rápida.</div>
      </div>
    </main>
  </div>
</body>
</html>
